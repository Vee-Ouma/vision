@{
    ViewBag.Title = "Search";
}

<script type="text/javascript">
    $(document).ready(function () {
        $('input.sph').rxForm({ autoZero: false });
        $('input.cyl').rxForm({ autoZero: false, min: -20, max: 0 });
        $('input.axis').rxForm({ autoZero: false, min: 0, max: 180, littleStep: 5, bigStep: 10, beforeDecimal: 3, afterDecimal: 0, autoDecimal: 999 });
        $('input.add').rxForm({ autoZero: false, min: 0, max: 20 });

        $('#searchButton').click(function () {
            $("#searchResults tbody").empty();

            var selectedTab = $('#searchby li.active a').attr('href');
            var url = (selectedTab === '#search_by_rx') ? '/Glasses/SearchByRx' : '/Glasses/SearchByCallNumber';
            var data = $(selectedTab + ' input').serializeArray()
            $.post(url, data, function (data) {
                $("#searchResultRow").tmpl(data).prependTo("#searchResults tbody");
            });
        });

        $('#clearButton').click(function () {
            $('.rx_form input[type=text]').each(function (index) { this.value = ''; });
            $('.rx_form input[type=checkbox]').each(function (index) { this.checked = false; });
            $("#searchResults tbody").empty();
        });
        $('#searchby a').click(function (e) {
            e.preventDefault();
            $(this).tab('show');
        })
    });
</script>

<h1>Search</h1>

<div id="searchForm">
    <div class="row-fluid">
        <div class="span12">
            <ul id="searchby" class="nav nav-tabs">
                <li class="active"><a href="#search_by_rx" data-toggle="tab">Search By Rx</a></li>
                <li><a href="#search_by_callnum" data-toggle="tab">Search By Call Number</a></li>
            </ul>
        </div>
    </div>
    <div class="tab-content">
        <div id="search_by_rx" class="row-fluid tab-pane active">
            <div class="span12">
                @Html.Partial("_RxForm")
            </div>
        </div>
        <div id="search_by_callnum" class="row-fluid tab-pane">
            <div class="span12">
                <div class="rx_form">
                    <div>Group:</div>
                    <div><input name="Group" type="text" /></div>
                    <div>Number:</div>
                    <div><input name="Number" type="text" /></div>
                </div>​

            </div>
        </div>
    </div>
    <div class="row-fluid">
        <div class="span12 new-row">
            <button id="searchButton" class="btn btn-large btn-success"><i class="icon-search icon-white"></i> Search</button>
            <button id="clearButton" class="btn btn-large">Clear</button>
            <span id="searchingMessage" class="hide"><img src="/img/spinner.gif" alt="Searching..." /> <strong>Searching...</strong></span>
            <hr />
        </div>
        
    </div>
</div>

<script id="searchResultRow" type="text/x-jquery-tmpl">
    <tr>
        <td>${Score}</td>
        <td>${Glasses.Group}/${Number}</td>
        <td class="table-horizontal-break">${sphcylFormat(Glasses.OD_Spherical)}</td>
        <td>${sphcylFormat(Glasses.OD_Cylindrical)}</td>
        <td>${axisFormat(Glasses.OD_Axis)}</td>
        <td>${sphcylFormat(Glasses.OD_Add)}</td>
        <td class="table-horizontal-break">${sphcylFormat(Glasses.OS_Spherical)}</td>
        <td>${sphcylFormat(Glasses.OS_Cylindrical)}</td>
        <td>${axisFormat(Glasses.OS_Axis)}</td>
        <td>${sphcylFormat(Glasses.OS_Add)}</td>
        <td class="table-horizontal-break">${Glasses.Sunglasses?'Yes':'No'}</td>
        <td>${Glasses.Gender}</td>
        <td>${Glasses.Size}</td>
    </tr>
</script>
<table id="searchResults" class="table table-striped table-bordered table-condensed">
    <thead>
    <tr>
        <th>Score</th>
        <th>Call #</th>
        <th>OD Sph</th>
        <th>OD Cyl</th>
        <th>OD Axis</th>
        <th>OD Add</th>
        <th>OS Sph</th>
        <th>OS Cyl</th>
        <th>OS Axis</th>
        <th>OS Add</th>
        <th>Sungl.</th>
        <th>Gender</th>
        <th>Size</th>
    </tr>
    </thead>
    <tbody>

    </tbody>
</table>